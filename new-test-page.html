<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UserScriptConfig Test Page</title>
  <link rel="stylesheet" href="userscript-style.css">
  <style>
    /* For demo info output */
    #output {
      margin: 24px 0;
      padding: 12px;
      font-family: monospace;
      background: #f8f8f8;
      border: 1px solid #eee;
    }
  </style>
</head>
<body>
  <h1>UserScriptConfig Library Test</h1>
  <button id="openSettingsBtn">Open Settings Dialog</button>
  <button id="resetDefaultsBtn">Reset to Defaults</button>
  <div id="output">Current values: (will show after Save or on open)</div>

  <script src="userscript-config.js"></script>
  <script>
    // --- Sample JSON configuration ---
    const rbCommonsConfig = {
      configId: 'betterRBCommons',
      headerText: "Better RBCommons Settings",
      groups: [
          { id: 'linkHandlers', name: 'Link Handlers', collapsedIf: { otherElementId: 'enableQuickFileOpenLinks', value: false } }
      ],
      settings: [
        {
          id: 'enableShowingExtraLinks',
          type: 'checkbox',
          labelText: 'Show extra navbar links',
          defaultValue: true
        },
        {
          id: 'enableShowingExactTimes',
          type: 'checkbox',
          labelText: 'Show exact times instead of relative',
          defaultValue: true
        },
        {
          id: 'enableFileGithubLink',
          type: 'checkbox',
          labelText: 'Show Github link for file',
          defaultValue: true
        },
        {
          id: 'baseGithubPath',
          type: 'textbox',
          labelText: 'Github file base path',
          placeholder: 'https://github.com/<path>/',
          defaultValue: 'https://github.com/onshape/newton/blob/master/',
          validationRegex: '^https:\/\/github\.com\/.+\/$',
          enabledIf: { otherElementId: 'enableFileGithubLink', value: true },
        },
        {
          id: 'enableQuickFileOpenLinks',
          type: 'checkbox',
          labelText: 'Show quick file open links',
          defaultValue: true
        },
        {
          id: 'newtonPath',
          type: 'textbox',
          labelText: 'Newton repository Path',
          placeholder: '/Users/<username>/repos/newton',
          defaultValue: '',
          validationRegex: '^\/.+\/.+',
          errorMessage: 'Please enter valid path to your newton directory',
          enabledIf: { otherElementId: 'enableQuickFileOpenLinks', value: true },
        },
        {
          id: 'defaultHandlerApp',
          type: 'dropdown',
          labelText: 'Default app for all extensions' ,
          defaultValue: 'VSCode',
          tooltip: 'Default extension handler for all unspecified extensions',
          options: [
            { value: 'VSCode', text: 'VS Code' },
            { value: 'idea', text: 'IntelliJ IDEA' },
            { value: 'webstorm', text: 'Webstorm' },
            { value: 'pycharm', text: 'PyCharm' }
          ],
          enabledIf: { otherElementId: 'enableQuickFileOpenLinks', value: true },
          groupId: 'linkHandlers'
        },
        {
          id: 'vscodeExtensions',
          type: 'textbox',
          labelText: 'Extensions opened by VSCode',
          placeholder: '.ts, .js, .html, .vue, ...',
          defaultValue: '.ts, .js, .glsl, .java, .cpp, .h',
          enabledIf: { otherElementId: 'enableQuickFileOpenLinks', value: true },
          groupId: 'linkHandlers'
        },
        {
          id: 'ideaExtensions',
          type: 'textbox',
          labelText: 'Extensions opened by IntelliJ IDEA',
          placeholder: '.java, ...',
          defaultValue: '',
          enabledIf: { otherElementId: 'enableQuickFileOpenLinks', value: true },
          groupId: 'linkHandlers'
        },
        {
          id: 'webstormExtensions',
          type: 'textbox',
          labelText: 'Extensions opened by Webstorm',
          placeholder: '.ts, .js, ...',
          defaultValue: '',
          enabledIf: { otherElementId: 'enableQuickFileOpenLinks', value: true },
          groupId: 'linkHandlers'
        },
        {
          id: 'pycharmExtensions',
          type: 'textbox',
          labelText: 'Extensions opened by Pycharm',
          placeholder: '.py, ...',
          defaultValue: '',
          enabledIf: { otherElementId: 'enableQuickFileOpenLinks', value: true },
          groupId: 'linkHandlers'
        }
      ],
      saveButtonText: "Save",
      cancelButtonText: "Cancel"
    };

    // --- Main Test Logic ---
    const outputDiv = document.getElementById('output');

    function showValues() {
      const vals = userSettings.getAllFieldValues();
      outputDiv.textContent = "Current values: " + JSON.stringify(vals, null, 2);
      // userSettings.openSettingsDialog();
    }

    function onOpen() {
      outputDiv.textContent = "[Dialog opened]";
    }
    function onSave() {
      showValues();
      outputDiv.textContent += "\n[Settings saved!]";
    }
    function onClose() {
      outputDiv.textContent += "\n[Dialog closed]";
    }
    function onChange(id, value) {
      outputDiv.textContent = `[Changed] ${id} = ${value}`;
    }

    function onLoad() {
      outputDiv.textContent = 'Settings loaded!';
    }

    const callbacks = {
      'onDialogOpened': undefined,
      'onSettingsSaved': onSave,
      'onDialogClosed': onClose,
      'onSettingChanged': onChange,
      'onSettingsLoaded': onLoad
    }

    const userSettings = new UserScriptConfig(rbCommonsConfig, callbacks);
    userSettings.init();

    // Demo button handlers
    document.getElementById('openSettingsBtn').onclick = () => {
      userSettings.openSettingsDialog();
    };
    document.getElementById('resetDefaultsBtn').onclick = () => {
      userSettings.resetToDefaults();
      showValues();
      alert("Defaults restored. Open settings to see.");
    };

    // Show values at load
    // showValues();
  </script>
</body>
</html>
